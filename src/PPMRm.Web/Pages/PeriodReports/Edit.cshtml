@page "{id}"
@model PPMRm.Web.Pages.PeriodReports.EditModel

@section scripts
{
    <abp-script src="/Pages/PeriodReports/Edit.js" />
    <abp-script src="/js/bootstrap-multiselect.min.js" />
    <abp-script src="/js/dataTables.buttons.min.js" />
}
@{
    <abp-card>
        <abp-card-header>
            <abp-row>
                <abp-column size-md="_6">
                    <abp-card-title class="">Status: @Model.PeriodReport.ReportStatus</abp-card-title>
                </abp-column>
                <abp-column size-md="_6" class="text-right">
                    <abp-button id="edit-cs-updates" data-id="@Model.Id"
                                text="View/Edit CS Updates"
                                button-type="Primary"/>
                    <abp-button id="close-period"
                                text="Close"
                                disabled="true"
                                button-type="Danger"/>
                </abp-column>
            </abp-row>
        </abp-card-header>
    </abp-card>
    <div class="jumbotron jumbotron-fluid">
  <div class="container">
    <h1 class="display-4">@Model.PeriodReport.Country.Name</h1>
    <p class="lead">@Model.PeriodReport.Period.Name</p>
  </div>
</div>
            <abp-input asp-for="Id" />
    @foreach(var program in Model.PeriodReport.Programs)
                {
                    <abp-card>
                        <abp-card-header>
                            <abp-row>
                                <abp-column size-md="_6">
                                    <abp-card-title>@program.Program.Name</abp-card-title>
                                </abp-column>
                                <abp-column size-md="_6" class="text-right">
                                    <abp-button class="btn-add-program-product"
                                                data-period-report-id="@program.PeriodReportId"
                                                data-program-id="@program.Program.Id"
                                                text="Add Product"
                                                icon="plus"
                                                button-type="Success"/>
                                </abp-column>
                            </abp-row>
                        </abp-card-header>
                       
                    </abp-card>
                    <abp-table class="table-striped table-bordered" data-id="@program.PeriodReportId" data-program-id="@program.Program.Id">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Min</th>
                                        <th>Max</th>
                                        <th>MOS</th>
                                        <th>Status</th>
                                        <th>Stock on Hand</th>
                                        <th>Date of SOH</th>
                                        <th>AMC</th>
                                        <th>Source of Consumption</th>
                                        <th>Action Recommended</th>
                                        <th>Action needed by</th>
                                        <th>Shipments</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach(var p in program.Products)
                                {
                                    <tr>
                                        <td>@p.Product.Name</td>
                                        <td>6</td>
                                        <td>12</td>
                                        <td>@p.MOS</td>
                                        <td></td>
                                        <td>@p.SOH</td>
                                        <td>@p.DateOfSOH</td>
                                        <td>@p.AMC</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>
                                             <abp-button  class="accordion-toggle" data-toggle="collapse" data-target="#@p.Product.Id-@p.Program.Id"
                                                    text="View (@(p.Shipments?.Count ?? 0))"
                                                    button-type="Link" />
                                        </td>
                                        <td>
                                            <abp-button data-id="@p.Product.Id" data-program-id="@p.Program.Id" data-period-report-id="@Model.Id"
                                                    class="btn-edit-product"
                                                    text="Edit"
                                                    button-type="Primary"/>
                                        </td>
                                        
                                    </tr>
                                    <tr>
                                      <td class="accordion-body collapse text-right" id="@p.Product.Id-@p.Program.Id" colspan="13">
                                        <table class="table">
                                          <thead>
                                          <tr>
                                           <th>Supplier</th>
                                            <th>Next Shipment Date</th>
                                            <th>Quantity</th>
                                            <th>Shipment MOS</th>
                                            <th>Data Source</th>
                                            <th></th>
                                          </tr>
                                          </thead>
                                          <tbody>
                                            @foreach(var s in p.Shipments.OrderBy(l => l.ShipmentDate))
                                            {
                                                <tr>
                                                    <td>@s.Supplier</td>
                                                    <td>@s.ShipmentDate?.ToString("yyyy-MM-dd") @s.ShipmentDateType</td>
                                                    <td>@s.Quantity.ToString("N0")</td>
                                                    <td>@s.MOS</td>
                                                    <td>@s.DataSource</td>
                                                    <td>
                                                        <abp-button data-id="@s.Id" data-product-id="@s.ProductId" data-program-id="@p.Program.Id" data-period-report-id="@Model.Id"
                                                                    class="btn-remove-shipment btn-sm"
                                                                    icon="minus"
                                                                    text=""
                                                                    disabled="true"
                                                                    button-type="Danger"/>
                                                    </td>
                                                </tr>
                                            }
                                            <tr>
                                                <td class="text-right" colspan="6">
                                                    <abp-button data-product-id="@p.Product.Id" data-program-id="@p.Program.Id" data-period-report-id="@Model.Id"
                                                                    class="btn-add-shipment btn-sm"
                                                                    icon="plus"
                                                                    text="Add Shipment"
                                                                    button-type="Success"/>
                                                    </td>
                                            </tr>
                                        </tbody>
                                        </table>
                                      </td>
                                    </tr>
                                }
                                @if(program.Products.Count == 0)
                        {
                            <tr>
                            <td class="text-center" colspan="13">No reports have been submitted for this program</td>
                            </tr>
                        }
                    </tbody>
                            </abp-table>
                    <hr class="my-4" />
                }
    
}

